{
  "metadata": {
    "config_name": "keep09",
    "model": "qwen2-7b-instruct",
    "hardware": {
      "gpu_count": 8,
      "gpu_model": "NVIDIA RTX 5880 Ada Generation",
      "gpu_memory_gb": 47.37200927734375,
      "cuda_version": "12.8"
    },
    "pruning_config": {
      "prune_layers": [
        4,
        7,
        10,
        13,
        16,
        19,
        22,
        25
      ],
      "keep_ratio": 0.9,
      "min_head_tokens": 4,
      "min_tail_ratio": 0.1,
      "cumulative_keep_ratio": 0.4304672100000001
    },
    "run_info": {
      "timestamp": "2025-12-29T00:57:46",
      "script": "inference_erecap.py",
      "mode": "profile",
      "benchmark_mode": "end2end"
    }
  },
  "results": {
    "1024": {
      "baseline": {
        "prefill_latency_seconds": 0.11576363304629922,
        "decode_latency_seconds": 2.1740106507204473,
        "total_latency_seconds": 2.2897742837667465,
        "memory_gb": 15.21665096282959,
        "kv_lens_after_prefill": [
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024,
          1024
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 0.1480604619719088,
        "decode_latency_seconds": 2.564825654029846,
        "total_latency_seconds": 2.712886116001755,
        "memory_gb": 14.490407943725586,
        "kv_lens_after_prefill": [
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438,
          438
        ],
        "tokens_kept": 438,
        "tokens_pruned": 586,
        "pruning_ratio": 0.572265625,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 0.7818672959987306,
        "decode": 0.847625119198511,
        "total": 0.8440362720206664
      },
      "kv_reduction": 0.572265625,
      "memory_reduction": 0.047726863215699106
    },
    "2048": {
      "baseline": {
        "prefill_latency_seconds": 0.2759818732738495,
        "decode_latency_seconds": 2.5821118555031717,
        "total_latency_seconds": 2.858093728777021,
        "memory_gb": 16.15322780609131,
        "kv_lens_after_prefill": [
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048,
          2048
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 0.21896467870101333,
        "decode_latency_seconds": 1.8251357832923532,
        "total_latency_seconds": 2.0441004619933665,
        "memory_gb": 14.69692850112915,
        "kv_lens_after_prefill": [
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879,
          879
        ],
        "tokens_kept": 879,
        "tokens_pruned": 1169,
        "pruning_ratio": 0.57080078125,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 1.260394484220401,
        "decode": 1.414750551241351,
        "total": 1.3982158812242842
      },
      "kv_reduction": 0.57080078125,
      "memory_reduction": 0.09015531276126709
    },
    "4096": {
      "baseline": {
        "prefill_latency_seconds": 0.6747718811966479,
        "decode_latency_seconds": 0.24675652105361223,
        "total_latency_seconds": 0.9215284022502601,
        "memory_gb": 18.011229038238525,
        "kv_lens_after_prefill": [
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096,
          4096
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 0.47763455798849463,
        "decode_latency_seconds": 2.8460304206237197,
        "total_latency_seconds": 3.3236649786122143,
        "memory_gb": 15.1237473487854,
        "kv_lens_after_prefill": [
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761,
          1761
        ],
        "tokens_kept": 1761,
        "tokens_pruned": 2335,
        "pruning_ratio": 0.570068359375,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 1.4127367249940528,
        "decode": 0.08670199702206081,
        "total": 0.2772627229820983
      },
      "kv_reduction": 0.570068359375,
      "memory_reduction": 0.1603156388341346
    },
    "8192": {
      "baseline": {
        "prefill_latency_seconds": 1.2885852679610252,
        "decode_latency_seconds": 3.2826084308326244,
        "total_latency_seconds": 4.57119369879365,
        "memory_gb": 21.737975120544434,
        "kv_lens_after_prefill": [
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192,
          8192
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 0.9515439821407199,
        "decode_latency_seconds": 3.3406876516528428,
        "total_latency_seconds": 4.292231633793563,
        "memory_gb": 15.943887710571289,
        "kv_lens_after_prefill": [
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523,
          3523
        ],
        "tokens_kept": 3523,
        "tokens_pruned": 4669,
        "pruning_ratio": 0.5699462890625,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 1.354204631783864,
        "decode": 0.9826145911032769,
        "total": 1.0649923137427546
      },
      "kv_reduction": 0.5699462890625,
      "memory_reduction": 0.2665421860979676
    },
    "16384": {
      "baseline": {
        "prefill_latency_seconds": 3.2952782320789993,
        "decode_latency_seconds": 4.545050475746393,
        "total_latency_seconds": 7.8403287078253925,
        "memory_gb": 29.191466331481934,
        "kv_lens_after_prefill": [
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384,
          16384
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 2.2147688972763717,
        "decode_latency_seconds": 4.461636011954397,
        "total_latency_seconds": 6.676404909230769,
        "memory_gb": 17.597832679748535,
        "kv_lens_after_prefill": [
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050,
          7050
        ],
        "tokens_kept": 7050,
        "tokens_pruned": 9334,
        "pruning_ratio": 0.5697021484375,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 1.487865499705812,
        "decode": 1.01869593655074,
        "total": 1.1743339138980902
      },
      "kv_reduction": 0.5697021484375,
      "memory_reduction": 0.39715831743710955
    },
    "32768": {
      "baseline": {
        "prefill_latency_seconds": 7.768245962914079,
        "decode_latency_seconds": 6.530389440711588,
        "total_latency_seconds": 14.298635403625667,
        "memory_gb": 44.097960472106934,
        "kv_lens_after_prefill": [
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768,
          32768
        ]
      },
      "erecap": {
        "prefill_latency_seconds": 5.080322843044996,
        "decode_latency_seconds": 7.257631108164787,
        "total_latency_seconds": 12.337953951209784,
        "memory_gb": 20.909603595733643,
        "kv_lens_after_prefill": [
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103,
          14103
        ],
        "tokens_kept": 14103,
        "tokens_pruned": 18665,
        "pruning_ratio": 0.569610595703125,
        "pruning_steps": 8
      },
      "speedup": {
        "prefill": 1.5290851000835255,
        "decode": 0.8997962755870772,
        "total": 1.1589146352928017
      },
      "kv_reduction": 0.569610595703125,
      "memory_reduction": 0.5258373999187674
    }
  },
  "summary": {
    "tested_lengths": [
      1024,
      2048,
      4096,
      8192,
      16384,
      32768
    ],
    "avg_speedup": 0.9862926231934493,
    "avg_memory_reduction": 0.2479559530441576
  }
}